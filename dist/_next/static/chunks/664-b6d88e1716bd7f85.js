(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[664],{9385:function(a,b,c){"use strict";c.r(b),c.d(b,{default:function(){return A}});var d=c(7568),e=c(1438),f=c(4924),g=c(8029),h=c(258),i=c(4051),j=c.n(i),k=c(5893),l=c(7294),m=c(214),n=c.n(m),o=c(6731),p=c(1091),q=c(3461);function r(a){return s.apply(this,arguments)}function s(){return(s=(0,d.Z)(j().mark(function a(b){var c;return j().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!b){a.next=5;break}return a.next=3,b.credentialsCounter();case 3:return c=a.sent,a.abrupt("return",c);case 5:case"end":return a.stop()}},a)}))).apply(this,arguments)}function t(a){return u.apply(this,arguments)}function u(){return(u=(0,d.Z)(j().mark(function a(b){var c,d,e;return j().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!b){a.next=7;break}return a.next=3,b.credentialsSchema();case 3:return e=(d=JSON.parse(c=a.sent)).schema_json.claims,a.abrupt("return",e);case 7:case"end":return a.stop()}},a)}))).apply(this,arguments)}function v(a,b){var c=(0,p.encrypt)({publicKey:a,data:JSON.stringify(b),version:"x25519-xsalsa20-poly1305"});return JSON.stringify(c)}function w(a,b,c){return x.apply(this,arguments)}function x(){return(x=(0,d.Z)(j().mark(function a(b,c,d){var e,f;return j().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!c){a.next=10;break}return a.next=3,c.saveCredential(b,d);case 3:return e=a.sent,a.next=6,e.wait();case 6:if(!(1!==(f=a.sent).status)){a.next=10;break}return alert("error while uploading credential"),a.abrupt("return");case 10:case"end":return a.stop()}},a)}))).apply(this,arguments)}function y(a){for(var b=["0x"],c=0,d=a.length;c<d;c++){var e=Number(a.charCodeAt(c)).toString(16);b.push(e)}return b.join("")}function z(a,b){if(a.claims.ethAddress){if(b){var c=a.claims.ethAddress,d=[];for(var e in b)"ethAddress"!==b[e]?d.push(y(a.claims[b[e]])):d.push(a.claims[b[e]]);var f=(0,q.poseidon)([d[0],d[1]]);if(b.length>2)for(var g=2;g<b.length;g++)f=(0,q.poseidon)([f,d[g]]);return(0,q.poseidon)([f,c])}}else throw"ethAddress not found as atribute in credential JSON"}var A=function(a){(0,g.Z)(c,a);var b=(0,h.Z)(c);function c(){return(0,e.Z)(this,c),b.apply(this,arguments)}return c.prototype.render=function(){var a=this,b=this,c=this;return(0,k.jsxs)("div",{className:n().issuerContainer,children:[(0,k.jsx)("h1",{children:"Issuer Portal"}),null===this.state|| void 0===this.state.claimsArray?(0,k.jsx)("button",{onClick:(0,d.Z)(j().mark(function a(){var c,d;return j().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t(b.props.credentialsDB);case 2:return c=a.sent,b.setState(function(a){return{claimsArray:c}}),a.next=6,r(b.props.credentialsDB);case 6:d=a.sent,b.setState(function(a){return{credentialsCounter:d}});case 8:case"end":return a.stop()}},a)})),children:"Read contract credential schema"}):(0,k.jsxs)("div",{className:n().issuerFormContainer,children:[(0,k.jsxs)("h3",{children:["Number of credentials issued:",this.state.credentialsCounter]}),(0,k.jsxs)("form",{className:n().issuerForm,onSubmit:function(b){b.preventDefault(),a.setState(function(a){return{enIssueModal:!0}})},children:[this.state.claimsArray.map(function(b,c){return(0,k.jsxs)("label",{className:n().formLabel,children:[(0,k.jsxs)("div",{children:[b,":"]}),(0,k.jsx)("input",{name:b,onChange:function(b){var c=b.target.name,d=b.target.value;if(void 0===a.state.credentialJSON){var e={claims:(0,f.Z)({},c,d)};a.setState(function(a){return{credentialJSON:e}})}else{var g=a.state.credentialJSON;g.claims[c]=d,a.setState(function(a){return{credentialJSON:g}})}}})]},b)}),(0,k.jsx)("button",{type:"submit",children:"Issue "})]}),this.state.enIssueModal?(0,k.jsxs)("div",{className:n().modalBackground,children:[(0,k.jsxs)("div",{className:n().modalContainer,children:[(0,k.jsx)("h3",{children:"Check claims and set subject eth public key"}),(0,k.jsx)("h4",{children:"Credential claims list"}),this.state.credentialJSON?(0,k.jsx)("ul",{children:this.state.claimsArray.map(function(b){return(0,k.jsxs)("li",{children:[b," = ",a.state.credentialJSON.claims[b]]},b)})}):(0,k.jsx)("div",{}),(0,k.jsx)("input",{placeholder:"Enter subject ethereum public key, not address",onChange:function(b){a.setState(function(a){return{subjectEthPubKey:b.target.value}})}}),(0,k.jsx)("button",{onClick:(0,d.Z)(j().mark(function a(){var b,d,e;return j().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c.props.credentialsDB&&(c.props.credentialsDB.on("CredentialSavedInRegister",function(a){a===c.state.credentialsCounter+1&&c.setState(function(a){return{step2flag:!0}})}),c.props.credentialsDB.on("LeafInserted",function(a,b){a.toBigInt()===d&&c.setState(function(a){return{step4flag:!0}})})),c.setState(function(a){return{issuancePocInit:!0}}),b=v(c.state.subjectEthPubKey,c.state.credentialJSON),c.setState(function(a){return{step1flag:!0}}),d=z(c.state.credentialJSON,c.state.claimsArray),c.setState(function(a){return{step3flag:!0}}),e=o.O$.from(d),e=e.toHexString(),a.next=11,w(b,c.props.credentialsDB,d);case 11:case"end":return a.stop()}},a)})),children:"Confirm credential issuance"})]}),this.state.issuancePocInit?(0,k.jsxs)("div",{children:[(0,k.jsxs)("div",{className:n().issueStep,children:[(0,k.jsx)("p",{children:"Encrypting credential with subject public key"}),this.state.step1flag?(0,k.jsx)("p",{className:n().check,children:"✅"}):(0,k.jsx)("div",{className:n().loadingSpinner})]}),(0,k.jsxs)("div",{className:n().issueStep,children:[(0,k.jsx)("p",{children:"Uploading encrypted credential to smart contract"}),this.state.step2flag?(0,k.jsx)("p",{className:n().check,children:"✅"}):(0,k.jsx)("div",{className:n().loadingSpinner})]}),(0,k.jsxs)("div",{className:n().issueStep,children:[(0,k.jsx)("p",{children:"Computing Credentials Merkle Tree leaf"}),this.state.step3flag?(0,k.jsx)("p",{className:n().check,children:"✅"}):(0,k.jsx)("div",{className:n().loadingSpinner})]}),(0,k.jsxs)("div",{className:n().issueStep,children:[(0,k.jsx)("p",{children:"Uploading leaf to smart contract and computing merkle root"}),this.state.step4flag?(0,k.jsx)("p",{className:n().check,children:"✅"}):(0,k.jsx)("div",{className:n().loadingSpinner})]})]}):(0,k.jsx)("div",{})]}):(0,k.jsx)("div",{})]})]})},c}(l.Component)},2772:function(){},6601:function(){},9214:function(){},7790:function(){},2361:function(){},4616:function(){},6567:function(){},8924:function(){},7500:function(){}}])